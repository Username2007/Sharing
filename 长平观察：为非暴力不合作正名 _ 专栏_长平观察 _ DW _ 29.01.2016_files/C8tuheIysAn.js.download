if (self.CavalryLogger) { CavalryLogger.start_js(["gFo9x"]); }

__d("TepigSubscriber",["BanzaiODS","DataAttributeUtils","RelayFBEnvironment","TepigPostNames","TepigUtilsTypes","ViewabilityFramework","gkx","promiseDone","relay-runtime","TepigSubscriberQuery.graphql"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("TepigPostNames").addPostName,i=b("TepigPostNames").getPostName,j=b("TepigUtilsTypes").TEPIG_ID_TYPES,k=b("TepigUtilsTypes").TEPIG_SIGNALS,l=b("TepigUtilsTypes").TEPIG_SOURCE,m=b("relay-runtime").fetchQuery;b("relay-runtime").graphql;var n=function(a,b){};a=[];var o=n,p=a;c=function(a){o=a;return function(){o=n}};var q=function(){p=p.filter(function(a){if(!(o!==n&&o(a.TepigInternalPayload,a.TepigExternalPayload)))return a})};d=function(a){if(!b("gkx")("985099")||!t(a))return;var c=a.TepigExternalSignalPayload?a.TepigExternalSignalPayload.targetElem:a.TepigExternalValidationSignalPayload?a.TepigExternalValidationSignalPayload.targetElem:null;if(c==null)return;var d=a.TepigExternalSignalPayload?a.TepigExternalSignalPayload.source:a.TepigExternalValidationSignalPayload?a.TepigExternalValidationSignalPayload.source:null;d===l.BLUE&&s(c,a)};var r=function(a,b){if(a.error!=null)return;var c=Date.now();a={idType:a.id_type,postName:a.post_title,postOrAdId:a.post_or_ad_id,time:c};p.push({TepigExternalPayload:b,TepigInternalPayload:a});q()},s=function(a,c){__p&&__p();var d={error:null,id_type:"",post_or_ad_id:"",post_title:""};try{a=JSON.parse(b("DataAttributeUtils").getDataFt(a));if(a!=null){var e;e=a==null?void 0:(e=a.page_insights)==null?void 0:(e=e[a==null?void 0:a.page_id])==null?void 0:(e=e.targets)==null?void 0:(e=e[0])==null?void 0:e.post_id;var f=a==null?void 0:a.adid;a=a==null?void 0:a.top_level_post_id;var k=null,l=null;e==null&&(e=a);if(f!=null&&f!==0){a=i(f);a!=null?(d.post_title=a,d.post_or_ad_id=f,r(d,c)):(k=f,l=j.ADID)}else if(e!=null&&e!==0){a=i(e);a!=null?(d.post_title=a,d.post_or_ad_id=e,r(d,c)):(k=e,l=j.POSTID)}if(k!=null&&l!=null){f=g||(g={modern:function(){return b("TepigSubscriberQuery.graphql")},classic:function(a){return{kind:"OperationDefinition",argumentDefinitions:[{defaultValue:null,kind:"LocalArgument",name:"params"}],name:"TepigSubscriberQuery",operation:"query",node:function(){return{children:[{calls:[{kind:"Call",metadata:{type:"TepigMetadataParams!"},name:"params",value:{kind:"CallVariable",callVariableName:"params"}}],children:[{fieldName:"post_name",kind:"Field",metadata:{},type:"String"}],fieldName:"tepig_post_metadata",kind:"Field",metadata:{canHaveSubselections:!0},type:"TepigTrackUnitMetadata"}],directives:[{kind:"Directive",name:"fb_owner",args:[{name:"oncall",value:{kind:"CallValue",callValue:"central_external_metrics"}}]}],id:a.__id(),kind:"Fragment",metadata:{},name:"TepigSubscriberQuery",type:"Query"}}()}}});e={params:(a={},a[l]=k,a)};b("promiseDone")(m(b("RelayFBEnvironment"),f,e).then(function(a){if(a==null||a.tepig_post_metadata==null||a.tepig_post_metadata.post_name==null||k==null||l==null)d.error="GraphQL query failed";else{var b;h(k,a==null?void 0:(b=a.tepig_post_metadata)==null?void 0:b.post_name);d.post_or_ad_id=k;d.post_title=(a=a==null?void 0:(b=a.tepig_post_metadata)==null?void 0:b.post_name)!=null?a:"";d.id_type=l;r(d,c)}}))}}}catch(a){b("BanzaiODS").bumpEntityKey(2977,"tepig_subscriber","subscriber failure. error fetching post_name using graphql."+a.message),d.error="Error caught (graphql attempt)"+String(a),r(d,c)}},t=function(a){__p&&__p();var c=[b("ViewabilityFramework").VIEWABLE_TRACKER_BLUE,b("ViewabilityFramework").INTERSECTION_OBSERVER_BLUE],d=[k.ENTER,k.EXIT,k.LOG,k.VALIDATE];if(a.TepigExternalSignalPayload!=null){var e=a.TepigExternalSignalPayload.impressionFramework,f=a.TepigExternalSignalPayload.signalType;if(c.includes(e)&&d.includes(f))return!0;else return!1}if(a.TepigExternalValidationSignalPayload!=null){c=a.TepigExternalValidationSignalPayload;e=c.validationSession.getPrimaryImpressionChannel();d=c.validationSession.getSecondaryImpressionChannel();if(e===b("ViewabilityFramework").VIEWABLE_TRACKER_BLUE&&d===b("ViewabilityFramework").INTERSECTION_OBSERVER_BLUE)return!0;else return!1}return!1};e.exports={sendSignal:d,subscribeToSignals:c}}),null);